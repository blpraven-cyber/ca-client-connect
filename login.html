<body>
  <div class="container">
    <header>
      <div class="logo">CA ConnectPro</div>
    </header>

    <main>
      <h1>Welcome Back</h1>
      <p>Please sign in to access your financial dashboard.</p>

      <!-- Google Login Button -->
      <div class="gmail-btn" id="g_id_onload"
        data-client_id="975035697931-sodrhfgkmuj51mstku31kb9h15jri31k.apps.googleusercontent.com"
        data-context="signin"
        data-ux_mode="popup"
        data-callback="handleCredentialResponse"
        data-auto_select="false"
        data-login_uri="http://localhost:5500/login.html"
        data-orp_support="true">
      </div>

      <div class="g_id_signin"
        data-type="standard"
        data-shape="rectangular"
        data-theme="outline"
        data-text="signin_with"
        data-size="large"
        data-logo_alignment="left">
      </div>

      <p class="new-client">
        Donâ€™t have an account? <a href="register.html">Register Now</a>
      </p>
    </main>
  </div>

  <!-- Load Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- Handle Login Response -->
  <script>
    function handleCredentialResponse(response) {
      // Decode the JWT to get user info
      const responsePayload = parseJwt(response.credential);

      // Save user to localStorage
      localStorage.setItem('user', JSON.stringify({
        name: responsePayload.name,
        email: responsePayload.email,
        picture: responsePayload.picture,
        role: 'client' // Will determine CA vs Client later
      }));

      // Redirect based on user
      if (responsePayload.email === 'ravi@ca.com') {
        window.location.href = 'ca-dashboard.html';
      } else {
        window.location.href = 'index.html';
      }
    }

    // Helper to decode JWT
    function parseJwt(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));

      return JSON.parse(jsonPayload);
    }
  </script>
</body>
</html>